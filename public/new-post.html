<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Create News Post</title>
    <link href="https://cdn.jsdelivr.net/npm/quill@2.0.2/dist/quill.snow.css" rel="stylesheet" />
    <script src="https://cdn.jsdelivr.net/npm/quill@2.0.2/dist/quill.js"></script>
    <!-- Include any necessary CSS for styling -->
    <style>
        /* Example CSS for basic layout */
        label {
            display: block;
            margin-bottom: 5px;
            font-weight: bold;
        }

        input[type="text"],
        select,
        textarea {
            width: 100%;
            padding: 8px;
            margin-bottom: 10px;
            border: 1px solid #ccc;
            border-radius: 4px;
            box-sizing: border-box;
            font-size: 14px;
        }

        textarea {
            height: 150px;
        }

        .editor-container {
            border: 1px solid #ccc;
            border-radius: 4px;
            padding: 10px;
        }
    </style>
</head>

<body>
    <h2>Create News Post</h2>
    <form enctype="multipart/form-data" id="sendPost">
        <label for="title">Title:</label>
        <input type="text" id="title" name="title" required>

        <label for="status">Status:</label>
        <select id="status" name="status">
            <option value="draft">Draft</option>
            <option value="public">Public</option>
            <option value="private">Private</option>
        </select>

        <label for="summary">Summary:</label>
        <textarea id="summary" name="summary" required></textarea>

        <label for="file">Upload File:</label>
        <input type="file" id="file" name="image">
        <button type="button" onclick="clearFile()">Clear Image</button>

        <label for="content">Content:</label>
        <div class="editor-container">
            <div id="editor" style="height: 200px"></div>
        </div>

        <button type="submit">Submit</button>
    </form>

    <!-- Include any necessary JavaScript libraries for advanced text editing capabilities -->
    <!-- For simplicity, including just a basic textarea for content editing -->
    <script>
        const toolbarOptions = [
            ['bold', 'italic', 'underline', 'strike'],        // toggled buttons
            ['blockquote', 'code-block'],
            ['link', 'formula'],

            [{ 'header': 1 }, { 'header': 2 }],               // custom button values
            [{ 'list': 'ordered' }, { 'list': 'bullet' }, { 'list': 'check' }],
            [{ 'script': 'sub' }, { 'script': 'super' }],      // superscript/subscript
            [{ 'indent': '-1' }, { 'indent': '+1' }],          // outdent/indent
            [{ 'direction': 'rtl' }],                         // text direction

            [{ 'size': ['small', false, 'large', 'huge'] }],  // custom dropdown
            [{ 'header': [1, 2, 3, 4, 5, 6, false] }],

            [{ 'color': [] }, { 'background': [] }],          // dropdown with defaults from theme
            [{ 'font': [] }],
            [{ 'align': [] }],

            ['clean']                                         // remove formatting button
        ];

        const quill = new Quill('#editor', {
            modules: {
                toolbar: toolbarOptions
            },
            theme: 'snow'
        });

        // Function to clear file input
        function clearFile() {
            const fileInput = document.getElementById('file');
            fileInput.value = ''; // Reset the file input
        }

        // Function to save form data to localStorage
        function saveFormData() {
            const formData = {
                title: document.getElementById('title').value,
                status: document.getElementById('status').value,
                summary: document.getElementById('summary').value,
                // Add more fields as needed
            };

            // Save HTML content from Quill editor
            formData.htmlContent = document.querySelector('.ql-editor').innerHTML;

            localStorage.setItem('formData', JSON.stringify(formData));
        }

        // Function to load form data from localStorage
        function loadFormData() {
            const storedFormData = localStorage.getItem('formData');
            if (storedFormData) {
                const formData = JSON.parse(storedFormData);
                document.getElementById('title').value = formData.title;
                document.getElementById('status').value = formData.status;
                document.getElementById('summary').value = formData.summary;
                // Populate HTML content into Quill editor
                quill.root.innerHTML = formData.htmlContent;
            }
        }

        // Load form data on page load
        document.addEventListener('DOMContentLoaded', loadFormData);

        // Attach event listeners to form elements to trigger saveFormData
        const formElements = document.querySelectorAll('#sendPost input, #sendPost select, #sendPost textarea, #editor');
        formElements.forEach(element => {
            element.addEventListener('input', saveFormData); // Save whenever input changes
            element.addEventListener('change', saveFormData); // Save whenever select changes
            element.addEventListener('click', saveFormData); // Save whenever button is clicked
            element.addEventListener('blur', saveFormData); // Save whenever element loses focus
        });

        const form = document.getElementById('sendPost');
        form.addEventListener("submit", (event) => {
            event.preventDefault();
            const formData = new FormData(form);

            // Get HTML content from Quill editor
            const htmlContent = quill.getSemanticHTML(0);
            formData.append('postBody', htmlContent);

            // Example: Log form data to console before sending
            for (var pair of formData.entries()) {
                console.log(pair[0] + ': ' + pair[1]);
            }

            // Send form data to backend (replace with your backend URL)
            fetch('/api/post', {
                method: 'POST',
                body: formData
            })
                .then(response => response.json())
                .then(data => {
                    console.log('Success:', data);
                    // Optionally redirect or show success message
                })
                .catch(error => {
                    console.error('Error:', error);
                    // Handle errors
                });
        });
    </script>

</body>

</html>